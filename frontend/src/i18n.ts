// === DeepForm i18n ===

type TranslationMap = Record<string, string>;

const ja: TranslationMap = {
  'nav.howItWorks': 'How it works',
  'nav.start': '始める',
  'hero.badge': 'AI-Powered Depth Interview',
  'hero.title1': 'PoCで止まらない。',
  'hero.title2': 'リリースできる仕様まで、一直線。',
  'hero.sub': 'AIがあればPoCは作れる。でも、その先がない。\nエッジケース、非機能要件、受け入れ基準——\nサービスにするために必要なことを、AIがインタビューから全部引き出します。',
  'hero.placeholder': '例：研究室の週末オペを楽にしたい…',
  'hero.inputLabel': '課題テーマを入力',
  'hero.cta': 'インタビューを開始',
  'problem.title': 'PoCは作れる。でも、その先がない。',
  'problem.desc': 'AIの発達で、思いつきを動くものにするまでは速くなった。\nでも現実には、PoCで止まるプロジェクトがほとんど。',
  'problem.item1': '「どんなエッジケースがあるか」がわからない',
  'problem.item2': '「セキュリティや可用性をどこまでやるか」が決められない',
  'problem.item3': '「これで実装して」と渡せる仕様書が書けない',
  'problem.item4': 'そもそもユーザーが本当に困っているか検証できていない',
  'problem.conclusion': 'エンジニアでない人には「何が足りないか」すら見えない。\nDeepFormは、そのギャップを埋める。',
  'depth.title': 'デプスインタビューとは',
  'depth.desc': '表面的なアンケートではなく、「なぜそう思うのか」「具体的にいつ困ったのか」を\n1対1の対話で深掘りする調査手法。',
  'depth.bad.label': '普通のアンケート',
  'depth.bad.text': '「この機能は便利ですか？」 → Yes / No',
  'depth.good.label': 'デプスインタビュー',
  'depth.good.text': '「最近それで困った具体的な場面は？」「そのときどうやって切り抜けた？」',
  'depth.conclusion': 'これにより、「あったらいいな」ではなく「なければ困る」真の課題が見えてくる。\nただし本来は専門スキルが必要——DeepFormはAIがそれを代行する。',
  'howItWorks.title': 'How it works',
  'howItWorks.sub': '5つのステップで、課題テーマから実装可能な仕様を生成',
  'step1.title': 'AI デプスインタビュー',
  'step1.desc': '熟練のインタビュアーAIが、具体例・頻度・困り度・回避策を深掘り',
  'step2.title': 'ファクト抽出',
  'step2.desc': '発話エビデンス付きで、事実・ペイン・頻度・回避策を構造化',
  'step3.title': '仮説生成',
  'step3.desc': '根拠リンク・反証パターン・未検証ポイント付きの仮説を自動生成',
  'step4.title': 'PRD 生成',
  'step4.desc': 'MVPスコープに圧縮された、テスト可能な受け入れ基準付きPRD',
  'step5.title': '実装仕様エクスポート',
  'step5.desc': 'API仕様・DBスキーマ・テストケースを spec.json で出力',
  'features.title': '差別化ポイント',
  'feat1.title': 'Evidence-linked 仕様',
  'feat1.desc': '要件と元発話がリンク。「なぜこの機能？」に常に答えられる。',
  'feat2.title': '反証付き仮説',
  'feat2.desc': '思い込みを防止。各仮説に反証パターンと未検証ポイントを明示。',
  'feat3.title': '深掘り専用AI',
  'feat3.desc': '具体例ベースで掘る専用ロジック。非エンジニアでもプロ級インタビュー。',
  'feat4.title': 'エージェント直投入',
  'feat4.desc': 'spec.json をコピーしてコーディングエージェントに貼るだけ。',
  'sessions.title': 'セッション一覧',
  'sessions.empty': 'まだセッションがありません',
  'footer.tagline': 'DeepForm — From vague idea → deployable spec.',
  'footer.credit': 'Built with Claude AI × exe.dev',
  'interview.title': 'AI デプスインタビュー',
  'interview.desc': '課題について、AIが具体的なエピソードを深掘りします',
  'interview.minAnswers': '3 回以上回答するとファクト抽出に進めます',
  'interview.placeholder': '回答を入力…',
  'interview.hint': 'Shift + Enter で送信　・　Enter で改行',
  'interview.next': 'ファクト抽出に進む →',
  'facts.title': '抽出されたファクト',
  'facts.desc': 'インタビューから抽出された事実・困りごと・頻度・回避策',
  'facts.next': '仮説生成に進む →',
  'hypotheses.title': '仮説（反証付き）',
  'hypotheses.desc': 'ファクトに基づく仮説と、それが成り立たない可能性',
  'hypotheses.next': 'PRD生成に進む →',
  'prd.title': 'PRD（プロダクト要件定義書）',
  'prd.desc': 'MVPスコープに圧縮された、テスト可能な受け入れ基準付きのPRD',
  'prd.next': '実装仕様を生成 →',
  'spec.title': '実装仕様',
  'spec.desc': 'コーディングエージェントにそのまま渡せる実装仕様',
  'spec.exportJson': 'spec.json をコピー',
  'spec.exportMd': 'PRD.md をコピー',
  'sidebar.share': '共有URLを発行',
  'sidebar.campaign': 'キャンペーンURLを発行',
  'stepnav.interview': 'インタビュー',
  'stepnav.facts': 'ファクト抽出',
  'stepnav.hypotheses': '仮説生成',
  'stepnav.prd': 'PRD',
  'stepnav.spec': '実装仕様',
  'shared.desc': 'このテーマについて、AIがあなたにいくつか質問します。\n日頃感じていることを率直に教えてください。',
  'shared.time': '所要時間：約5分',
  'shared.nameLabel': 'お名前（任意）',
  'shared.namePlaceholder': '例：田中太郎',
  'shared.start': 'インタビューを始める',
  'shared.complete': 'インタビューを完了する →',
  'shared.factsTitle': '抽出されたファクト',
  'shared.factsDesc': 'あなたの回答から以下のファクトが抽出されました。\n修正や補足があればフィードバック欄に記入してください。',
  'shared.feedbackLabel': 'フィードバック（任意）',
  'shared.feedbackPlaceholder': '抽出内容への修正や追加コメントがあれば…',
  'shared.submit': '送信して完了',
  'shared.thanksTitle': 'ありがとうございました！',
  'shared.thanksDesc': 'あなたのフィードバックは開発チームに届けられます。\n貴重なご意見をありがとうございました。',
  'loading.default': 'AIが分析中…',
  'loading.session': 'セッションを作成中…',
  'loading.load': 'セッションを読み込み中…',
  'loading.facts': 'AIがファクトを抽出中…',
  'loading.hypotheses': 'AIが仮説を生成中…',
  'loading.prd': 'AIがPRDを生成中…',
  'loading.spec': 'AIが実装仕様を生成中…',
  'toast.factsDone': 'ファクト抽出が完了しました',
  'toast.hypothesesDone': '仮説生成が完了しました',
  'toast.prdDone': 'PRD生成が完了しました',
  'toast.specDone': '実装仕様生成が完了しました',
  'toast.copied': 'クリップボードにコピーしました',
  'toast.shareUrl': '共有URLをコピーしました',
  'toast.enterTheme': 'テーマを入力してください',
  'toast.notFound': 'インタビューが見つかりません',
  'toast.campaignUrl': 'キャンペーンURLをコピーしました',
  'status.interviewing': 'インタビュー中',
  'status.analyzed': 'ファクト抽出済',
  'status.respondent_done': '回答完了',
  'status.hypothesized': '仮説生成済',
  'status.prd_generated': 'PRD生成済',
  'status.spec_generated': '実装仕様完了',
  'factType.fact': '事実',
  'factType.pain': '困りごと',
  'factType.frequency': '頻度',
  'factType.workaround': '回避策',
  'hypo.supporting': '根拠ファクト:',
  'hypo.counter': '反証:',
  'hypo.unverified': '未検証ポイント:',
  'hypo.feedback': '回答者からのフィードバック',
  'chat.thinking': '考え中',
  'shared.tag': '共有済',
  'auth.login': 'exe.dev でログイン',
  'auth.logout': 'ログアウト',
  'auth.loginRequired': 'セッションを作成するにはログインしてください',
  'session.public': '公開',
  'session.private': '非公開',
  'next.summary': 'コーディングエージェントで実装を開始',
  'next.badge': 'おすすめ',
  'next.exe.title': 'exe.dev + Shelley',
  'next.exe.desc': 'VM上のShelleyに spec.json を貼り付けるだけ。環境構築からデプロイまで一気に実行。',
  'next.exe.code': 'spec.json を貼って「これを実装して」',
  'next.claude.title': 'Claude Code',
  'next.claude.desc': 'ローカル環境で PRD.md をリポジトリに置いて、Claude Code で実装を開始。',
  'next.claude.code': 'PRD.md をリポジトリルートに配置',
  'next.cursor.title': 'Cursor',
  'next.cursor.desc': 'Cursor のチャットに spec.json を貼り付けて、対話しながら実装。',
  'next.cursor.code': 'spec.json を Composer に貼り付け',
  'next.other.title': 'その他のエージェント',
  'next.other.desc': 'GitHub Copilot, Devin, Cline, Windsurf など、任意のコーディングエージェントで利用可能。',
  'next.other.code': 'spec.json は標準JSON形式',
  'legal.privacy': 'プライバシーポリシー',
  'legal.terms': '利用規約',
  'legal.security': 'セキュリティポリシー',
};

const en: TranslationMap = {
  'nav.howItWorks': 'How it works',
  'nav.start': 'Get started',
  'hero.badge': 'AI-Powered Depth Interview',
  'hero.title1': "Don't stop at PoC.",
  'hero.title2': 'Ship-ready specs, end to end.',
  'hero.sub': 'AI can build a PoC. But what comes next?\nEdge cases, non-functional requirements, acceptance criteria—\nDeepForm extracts everything you need through AI-driven interviews.',
  'hero.placeholder': 'e.g. Make weekend lab operations easier…',
  'hero.inputLabel': 'Enter your challenge theme',
  'hero.cta': 'Start interview',
  'problem.title': 'You can build a PoC. But then what?',
  'problem.desc': 'AI made it fast to turn ideas into working prototypes.\nBut in reality, most projects stall at the PoC stage.',
  'problem.item1': "You don't know what edge cases exist",
  'problem.item2': "You can't decide how far to go on security and availability",
  'problem.item3': "You can't write a spec that engineers can actually implement",
  'problem.item4': "You haven't even validated whether users truly have this problem",
  'problem.conclusion': "If you're not an engineer, you can't even see what's missing.\nDeepForm bridges that gap.",
  'depth.title': 'What is a Depth Interview?',
  'depth.desc': 'Not a surface-level survey. A 1-on-1 conversation that digs into\n"why do you think that?" and "when exactly did that happen?"',
  'depth.bad.label': 'Typical survey',
  'depth.bad.text': '"Is this feature useful?" → Yes / No',
  'depth.good.label': 'Depth interview',
  'depth.good.text': '"Tell me about a specific time you struggled with this." "How did you work around it?"',
  'depth.conclusion': 'This reveals real pain points, not "nice to haves."\nIt normally requires expert skills—DeepForm\'s AI handles it for you.',
  'howItWorks.title': 'How it works',
  'howItWorks.sub': '5 steps from problem theme to implementable spec',
  'step1.title': 'AI Depth Interview',
  'step1.desc': 'AI interviewer digs into specific examples, frequency, severity, and workarounds',
  'step2.title': 'Fact Extraction',
  'step2.desc': 'Structured facts, pains, frequencies, and workarounds with source evidence',
  'step3.title': 'Hypothesis Generation',
  'step3.desc': 'Auto-generated hypotheses with supporting evidence, counter-evidence, and unknowns',
  'step4.title': 'PRD Generation',
  'step4.desc': 'MVP-scoped PRD with testable acceptance criteria',
  'step5.title': 'Spec Export',
  'step5.desc': 'API specs, DB schema, and test cases exported as spec.json',
  'features.title': 'Key Differentiators',
  'feat1.title': 'Evidence-linked Specs',
  'feat1.desc': 'Every requirement links back to user statements. Always answer "why this feature?"',
  'feat2.title': 'Counter-evidence on Hypotheses',
  'feat2.desc': 'Prevent confirmation bias. Each hypothesis shows counter-patterns and unknowns.',
  'feat3.title': 'Purpose-built Interview AI',
  'feat3.desc': 'Specialized logic for depth interviews. Pro-level insights without the expertise.',
  'feat4.title': 'Agent-ready Export',
  'feat4.desc': 'Copy spec.json and paste it directly into your coding agent.',
  'sessions.title': 'Sessions',
  'sessions.empty': 'No sessions yet',
  'footer.tagline': 'DeepForm — From vague idea → deployable spec.',
  'footer.credit': 'Built with Claude AI × exe.dev',
  'interview.title': 'AI Depth Interview',
  'interview.desc': 'AI will dig into specific episodes about your challenge',
  'interview.minAnswers': 'Answer at least 3 times to unlock fact extraction',
  'interview.placeholder': 'Type your answer…',
  'interview.hint': 'Shift + Enter to send · Enter for new line',
  'interview.next': 'Extract facts →',
  'facts.title': 'Extracted Facts',
  'facts.desc': 'Facts, pains, frequencies, and workarounds extracted from the interview',
  'facts.next': 'Generate hypotheses →',
  'hypotheses.title': 'Hypotheses (with counter-evidence)',
  'hypotheses.desc': 'Hypotheses based on facts, and why they might not hold',
  'hypotheses.next': 'Generate PRD →',
  'prd.title': 'PRD (Product Requirements Document)',
  'prd.desc': 'MVP-scoped PRD with testable acceptance criteria',
  'prd.next': 'Generate spec →',
  'spec.title': 'Implementation Spec',
  'spec.desc': 'Implementation spec ready to hand off to a coding agent',
  'spec.exportJson': 'Copy spec.json',
  'spec.exportMd': 'Copy PRD.md',
  'sidebar.share': 'Generate share URL',
  'sidebar.campaign': 'Create campaign URL',
  'stepnav.interview': 'Interview',
  'stepnav.facts': 'Facts',
  'stepnav.hypotheses': 'Hypotheses',
  'stepnav.prd': 'PRD',
  'stepnav.spec': 'Spec',
  'shared.desc': 'AI will ask you a few questions about this topic.\nPlease share your honest thoughts and experiences.',
  'shared.time': 'Estimated time: ~5 min',
  'shared.nameLabel': 'Your name (optional)',
  'shared.namePlaceholder': 'e.g. John Doe',
  'shared.start': 'Start interview',
  'shared.complete': 'Complete interview →',
  'shared.factsTitle': 'Extracted Facts',
  'shared.factsDesc': 'The following facts were extracted from your answers.\nPlease provide feedback if anything needs correction.',
  'shared.feedbackLabel': 'Feedback (optional)',
  'shared.feedbackPlaceholder': 'Any corrections or additional comments…',
  'shared.submit': 'Submit and finish',
  'shared.thanksTitle': 'Thank you!',
  'shared.thanksDesc': 'Your feedback will be shared with the development team.\nWe appreciate your valuable input.',
  'loading.default': 'AI is analyzing…',
  'loading.session': 'Creating session…',
  'loading.load': 'Loading session…',
  'loading.facts': 'AI is extracting facts…',
  'loading.hypotheses': 'AI is generating hypotheses…',
  'loading.prd': 'AI is generating PRD…',
  'loading.spec': 'AI is generating spec…',
  'toast.factsDone': 'Fact extraction complete',
  'toast.hypothesesDone': 'Hypothesis generation complete',
  'toast.prdDone': 'PRD generation complete',
  'toast.specDone': 'Spec generation complete',
  'toast.copied': 'Copied to clipboard',
  'toast.shareUrl': 'Share URL copied',
  'toast.enterTheme': 'Please enter a theme',
  'toast.notFound': 'Interview not found',
  'toast.campaignUrl': 'Campaign URL copied',
  'status.interviewing': 'Interviewing',
  'status.analyzed': 'Facts extracted',
  'status.respondent_done': 'Response complete',
  'status.hypothesized': 'Hypotheses ready',
  'status.prd_generated': 'PRD ready',
  'status.spec_generated': 'Spec complete',
  'factType.fact': 'Fact',
  'factType.pain': 'Pain',
  'factType.frequency': 'Frequency',
  'factType.workaround': 'Workaround',
  'hypo.supporting': 'Supporting facts:',
  'hypo.counter': 'Counter-evidence:',
  'hypo.unverified': 'Unverified:',
  'hypo.feedback': 'Respondent feedback',
  'chat.thinking': 'Thinking',
  'shared.tag': 'Shared',
  'auth.login': 'Sign in with exe.dev',
  'auth.logout': 'Sign out',
  'auth.loginRequired': 'Please sign in to create sessions',
  'session.public': 'Public',
  'session.private': 'Private',
  'next.summary': 'Start building with a coding agent',
  'next.badge': 'Recommended',
  'next.exe.title': 'exe.dev + Shelley',
  'next.exe.desc': 'Paste spec.json into Shelley on a VM. From setup to deploy, all in one shot.',
  'next.exe.code': 'Paste spec.json and say "implement this"',
  'next.claude.title': 'Claude Code',
  'next.claude.desc': 'Place PRD.md in your repo and start implementing with Claude Code locally.',
  'next.claude.code': 'Place PRD.md at repository root',
  'next.cursor.title': 'Cursor',
  'next.cursor.desc': "Paste spec.json into Cursor's chat and build interactively.",
  'next.cursor.code': 'Paste spec.json into Composer',
  'next.other.title': 'Other agents',
  'next.other.desc': 'Compatible with GitHub Copilot, Devin, Cline, Windsurf, and any coding agent.',
  'next.other.code': 'spec.json is standard JSON',
  'legal.privacy': 'Privacy Policy',
  'legal.terms': 'Terms of Service',
  'legal.security': 'Security Policy',
};

const es: TranslationMap = {
  'nav.howItWorks': 'Cómo funciona',
  'nav.start': 'Comenzar',
  'hero.badge': 'Entrevista en profundidad con IA',
  'hero.title1': 'No te quedes en el PoC.',
  'hero.title2': 'Specs listas para producción, de punta a punta.',
  'hero.sub': 'Con IA puedes crear un PoC. Pero ¿qué viene después?\nCasos límite, requisitos no funcionales, criterios de aceptación—\nDeepForm extrae todo lo necesario a través de entrevistas con IA.',
  'hero.placeholder': 'Ej: Simplificar las operaciones de fin de semana…',
  'hero.inputLabel': 'Ingresa el tema de tu desafío',
  'hero.cta': 'Iniciar entrevista',
  'howItWorks.title': 'Cómo funciona',
  'howItWorks.sub': '5 pasos del tema del problema a la especificación implementable',
  'auth.login': 'Iniciar sesión con exe.dev',
  'auth.logout': 'Cerrar sesión',
  'auth.loginRequired': 'Inicie sesión para crear sesiones',
  'legal.privacy': 'Política de Privacidad',
  'legal.terms': 'Términos de Servicio',
  'legal.security': 'Política de Seguridad',
};

const TRANSLATIONS: Record<string, TranslationMap> = { ja, en, es };

export let currentLang: string =
  localStorage.getItem('deepform-lang') ??
  navigator.language?.substring(0, 2) ??
  'ja';
if (!TRANSLATIONS[currentLang]) currentLang = 'en';

export function t(key: string): string {
  return TRANSLATIONS[currentLang]?.[key] ?? TRANSLATIONS['ja']?.[key] ?? key;
}

export function setLang(lang: string): void {
  if (!TRANSLATIONS[lang]) return;
  currentLang = lang;
  localStorage.setItem('deepform-lang', lang);
  document.documentElement.lang = lang;
  applyTranslations();
  document.querySelectorAll<HTMLElement>('.lang-btn').forEach((b) => {
    b.classList.toggle('active', b.dataset.lang === lang);
  });
}

export function applyTranslations(): void {
  document.querySelectorAll<HTMLElement>('[data-i18n]').forEach((el) => {
    const key = el.dataset.i18n!;
    const val = t(key);
    if (el instanceof HTMLInputElement || el instanceof HTMLTextAreaElement) {
      el.placeholder = val;
    } else {
      el.innerHTML = val.replace(/\n/g, '<br>');
    }
  });
}
